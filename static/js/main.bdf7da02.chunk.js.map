{"version":3,"sources":["components/Board.js","pages/GL.js","shaders/vs.js","shaders/fs.js","App.js","index.js"],"names":["allCells","MaxSize","Math","pow","StartOffsetX","StartOffsetY","RootCellId","level","x","NumLevels","y","MinBalance","Big","DrawGas","mul","toFixed","intToColor","c","toString","padStart","s","JSON","stringify","p2c","p","trunc","Board","contract","ctx","redraw","this","pixelQueue","pendingPixels","pending","sendQueueTimer","numFailedTxs","needRedraw","cellIds","a","get_cells_json","cell_ids","cells","reduce","acc","cellId","i","cellIdStr","nonce","colors","Array","CellSize","fill","cell","color","w","fillStyle","fillRect","imageData","createImageData","data","off","j","index","putImageData","sort","b","localeCompare","pixels","splice","get_storage_balance","account_id","account","accountId","balance","draw_json","lt","indexOf","refreshAllowance","console","log","concat","forEach","ready","clearTimeout","length","sendQueue","setTimeout","pingQueue","getCell","internalRedraw","ab","sp","push","modifyPixel","q","fetchCells","newCells","Object","entries","parse","internalRender","oldCell","newCellId","internalPaint","setCell","Sq3","sqrt","DxA","DxB","lastMousePos","isDrawMode","view","zoom","aspect","dxdyToAb","dx","dy","GlPage","props","canvasEl","useRef","berryclub","_near","propsDraw","draw","useEffect","current","getContext","drawNow","dist","na","nb","cy","cx","ta","tb","best","minD","d","board","gl","programInfo","twgl","arrays","a_position","a_texcoord","a_ab","numComponents","TexSize","bufferInfo","canvas","document","createElement","width","height","clearRect","textures","fromCanvas","src","mag","NEAREST","min","wrap","CLAMP_TO_EDGE","refreshCells","setInterval","requestAnimationFrame","render","time","viewport","uniforms","resolution","texSize","pos","u_diffuse","useProgram","program","setupRender","addEventListener","e","clientX","clientY","rect","target","getBoundingClientRect","buttons","preventDefault","mb","ma","newZoom","max","exp","deltaY","oa","ob","resize","pixelRatio","window","devicePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","innerWidth","documentElement","clientWidth","body","innerHeight","clientHeight","assign","ref","className","NearConfig","networkId","nodeUrl","archivalNodeUrl","contractName","walletUrl","App","lsKey","lsKeyRecentCards","state","connected","isNavCollapsed","requests","recentCards","ls","get","_initNear","then","setState","signedIn","signedAccountId","keyStore","nearAPI","BrowserLocalStorageKeyStore","deps","near","archivalConnection","fromConfig","provider","type","args","url","signer","walletConnection","getAccountId","viewMethods","changeMethods","requestSignIn","signOut","_accountId","slice","r","cardId","unshift","set","alert","logOut","passProps","updateState","popRequest","addRequest","addRecentCard","header","onClick","style","float","role","aria-hidden","href","data-ribbon","title","React","Component","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.bdf7da02.chunk.js","sourcesContent":["import Big from \"big.js\";\n\nconst allCells = {};\n\nconst Limit = 16;\nconst CellSize = 16;\nconst CellSize2 = CellSize * CellSize;\nconst NumLevels = 3;\nconst MaxNumberLevels = 5;\nconst MaxSize = Math.pow(CellSize, MaxNumberLevels);\nexport const StartOffsetX = MaxSize / 2;\nexport const StartOffsetY = MaxSize / 2;\n\nconst RootCellId = {\n  level: NumLevels,\n  x: StartOffsetX / Math.pow(CellSize, NumLevels + 1),\n  y: StartOffsetY / Math.pow(CellSize, NumLevels + 1),\n};\n\nconst MinBalance = Big(10).pow(23);\nconst DrawGas = Big(100).mul(Big(10).pow(12)).toFixed(0);\n\nconst intToColor = (c) => `#${(c & 0xffffff).toString(16).padStart(6, \"0\")}`;\nconst s = (c) => JSON.stringify(c);\nconst p = (c) => JSON.parse(c);\nconst p2c = (p) => ({\n  x: Math.trunc(p.x / CellSize),\n  y: Math.trunc(p.y / CellSize),\n  level: 0,\n});\n\nconst BatchOfPixels = 100;\nconst BatchTimeout = 250;\n\nexport class Board {\n  constructor(contract, ctx, redraw) {\n    this.contract = contract;\n    this.ctx = ctx;\n    this.redraw = redraw;\n    this.pixelQueue = [];\n    this.pendingPixels = [];\n    this.pending = {};\n    this.sendQueueTimer = null;\n    this.numFailedTxs = 0;\n\n    this.needRedraw = false;\n  }\n\n  async fetchCells(cellIds) {\n    const cells = await this.contract.get_cells_json({cell_ids: cellIds});\n    return cellIds.reduce((acc, cellId, i) => {\n      acc[s(cellId)] = cells[i];\n      return acc;\n    }, {})\n  }\n\n  getCell(cellId) {\n    const cellIdStr = s(cellId);\n    if (cellIdStr in allCells) {\n      return allCells[cellIdStr]\n    } else {\n      return {\n        nonce: 0,\n        colors: new Array(CellSize2).fill(0),\n      }\n    }\n  }\n\n  setCell(cellId, cell) {\n    allCells[s(cellId)] = cell;\n  }\n\n  internalPaint(cellId, color) {\n    if (!(s(cellId) in allCells)) {\n      const w = Math.pow(CellSize, cellId.level + 1);\n      const x = cellId.x * w - StartOffsetX;\n      const y = cellId.y * w - StartOffsetY;\n      this.ctx.fillStyle = intToColor(color);\n      this.ctx.fillRect(x, y, w, w);\n      this.needRedraw = true;\n    }\n  }\n\n  internalRender(cellId, cell) {\n    const imageData = this.ctx.createImageData(CellSize, CellSize);\n    const data = imageData.data;\n    let off = 0;\n    for (let i = 0; i < CellSize; ++i) {\n      for (let j = 0; j < CellSize; ++j) {\n        const index = i * CellSize + j;\n        const color = cell.colors[index];\n        data[off++] = (color >> 16) & 0xff;\n        data[off++] = (color >> 8) & 0xff;\n        data[off++] = color & 0xff;\n        data[off++] = 255;\n      }\n    }\n    const w = Math.pow(CellSize, cellId.level + 1);\n    const x = cellId.x * w - StartOffsetX;\n    const y = cellId.y * w - StartOffsetY;\n    this.ctx.putImageData(imageData, x, y);\n    this.needRedraw = true;\n  }\n\n  internalRedraw() {\n    if (this.needRedraw) {\n      this.needRedraw = false;\n      this.redraw();\n    }\n  }\n\n  async sendQueue() {\n    this.pixelQueue.sort((a, b) => s(p2c(a)).localeCompare(s(p2c(b))))\n    const pixels = this.pixelQueue.splice(0, BatchOfPixels);\n    this.pendingPixels = pixels;\n\n    const balance = Big(await this.contract.get_storage_balance({\n      account_id: this.contract.account.accountId\n    }) || \"0\");\n\n    try {\n      await this.contract.draw_json({\n        pixels\n      }, DrawGas, balance.lt(MinBalance) ? \"1000000000000000000000000\" : \"0\");\n      this.numFailedTxs = 0;\n    } catch (error) {\n      const msg = error.toString();\n      if (msg.indexOf(\"does not have enough balance\") !== -1) {\n        await this.refreshAllowance();\n        return;\n      }\n      console.log(\"Failed to send a transaction\", error);\n      this.numFailedTxs += 1;\n      if (this.numFailedTxs < 3) {\n        this.pixelQueue = this.pixelQueue.concat(this.pendingPixels);\n        this.pendingPixels = [];\n      } else {\n        this.pendingPixels = [];\n        this.pixelQueue = [];\n      }\n    }\n    // try {\n    //   await Promise.all([this.refreshBoard(true), this.refreshAccountStats()]);\n    // } catch (e) {\n    //   // ignore\n    // }\n    this.pendingPixels.forEach((p) => delete this.pending[s(p)]);\n    this.pendingPixels = [];\n  }\n\n  async pingQueue(ready) {\n    if (this.sendQueueTimer) {\n      clearTimeout(this.sendQueueTimer);\n      this.sendQueueTimer = null;\n    }\n\n    if (\n      this.pendingPixels.length === 0 &&\n      (this.pixelQueue.length >= BatchOfPixels || ready)\n    ) {\n      await this.sendQueue();\n    }\n    if (this.pixelQueue.length > 0) {\n      this.sendQueueTimer = setTimeout(async () => {\n        await this.pingQueue(true);\n      }, BatchTimeout);\n    }\n  }\n\n  modifyPixel(p) {\n    const cellId = p2c(p);\n    const cell = this.getCell(cellId);\n    const index = (p.y - cellId.y * CellSize) * CellSize + p.x - cellId.x * CellSize;\n    cell.colors[index] = p.c;\n\n    const x = p.x - StartOffsetX;\n    const y = p.y - StartOffsetY;\n    this.ctx.fillStyle = intToColor(p.c);\n    this.ctx.fillRect(x, y, 1, 1);\n    this.needRedraw = true;\n    setTimeout(() => {\n      this.internalRedraw();\n    }, 100)\n  }\n\n  draw(ab) {\n    const c = 0xffffff;\n    const p = {\n      x: StartOffsetX + ab.a,\n      y: StartOffsetY + ab.b,\n      c,\n    };\n    const sp = s(p);\n    if (!(sp in this.pending)) {\n      this.pending[sp] = true;\n      this.pixelQueue.push(p);\n\n      this.modifyPixel(p);\n    }\n\n    this.pingQueue(false);\n  }\n\n  async refreshCells() {\n    const q = [RootCellId];\n    while (q.length > 0) {\n      const cellIds = q.splice(0, Limit);\n      const newCells = await this.fetchCells(cellIds);\n      Object.entries(newCells).forEach(([cellId, cell]) => {\n        if (cell) {\n          cellId = p(cellId);\n          if (cellId.level === 0) {\n            this.internalRender(cellId, cell);\n          } else {\n            let oldCell = this.getCell(cellId);\n            if (cell.nonce !== oldCell.nonce) {\n              for (let i = 0; i < CellSize; ++i) {\n                for (let j = 0; j < CellSize; ++j) {\n                  const index = i * CellSize + j;\n                  if (cell.colors[index] !== oldCell.colors[index]) {\n                    const newCellId = {\n                      level: cellId.level - 1,\n                      x: cellId.x * CellSize + j,\n                      y: cellId.y * CellSize + i,\n                    };\n                    this.internalPaint(newCellId, cell.colors[index]);\n                    q.push(newCellId);\n                  }\n                }\n              }\n            }\n          }\n          this.setCell(cellId, cell);\n        }\n      });\n      this.internalRedraw();\n    }\n  }\n};\n","import React, {useEffect, useRef} from 'react';\nimport * as twgl from 'twgl-base.js';\nimport vs from '../shaders/vs';\nimport fs from '../shaders/fs';\nimport {Board} from \"../components/Board\";\n\n\nconst Sq3 = Math.sqrt(3.0) / 2;\nconst DxA = Sq3 * 2;\nconst DyA = 0;\nconst DxB = Sq3;\nconst DyB = 1.5;\n\nconst InitialZoom = 1;\nconst MinZoom = 1 / 64;\n\nconst TexSize = 2048;\n\nlet lastMousePos = null;\nlet isDrawMode = false;\nlet view = {\n  a: 0,\n  b: 0,\n  zoom: InitialZoom,\n  aspect: 1,\n};\n\n\nfunction setupRender(berryclub, gl) {\n  const programInfo = twgl.createProgramInfo(gl, [vs, fs])\n\n  const arrays = {\n    a_position: [\n      -Sq3 - Sq3/2, 0.75, 0,\n      Sq3 - Sq3/2, 0.75, 0,\n      0 - Sq3/2, -0.75, 0,\n\n      Sq3 - Sq3/2, 0.75, 0,\n      Sq3 * 2 - Sq3/2, -0.75, 0,\n      0 - Sq3/2, -0.75, 0,\n    ],\n    a_texcoord: [\n      0, 0,\n      1, 0,\n      0, 1,\n\n      1, 0,\n      1, 1,\n      0, 1,\n    ],\n    a_ab: {\n      numComponents: 2, data: [\n        -0.5, -0.5,\n        TexSize - 0.5, -0.5,\n        -0.5, TexSize - 0.5,\n\n        TexSize - 0.5, -0.5,\n        TexSize - 0.5, TexSize - 0.5,\n        -0.5, TexSize - 0.5,\n      ]\n    }\n  };\n  const bufferInfo = twgl.createBufferInfoFromArrays(gl, arrays);\n\n  const canvas = document.createElement('canvas');\n  canvas.width = TexSize;\n  canvas.height = TexSize;\n  const ctx = canvas.getContext('2d');\n  ctx.clearRect(0, 0, TexSize, TexSize);\n  // ctx.fillStyle = '#222222';\n  // ctx.fillRect(0, 0, TexSize, TexSize);\n\n  const textures = twgl.createTextures(gl, {\n    fromCanvas: { src: canvas, mag: gl.NEAREST, min: gl.NEAREST, wrap: gl.CLAMP_TO_EDGE },\n  });\n\n  const board = new Board(berryclub, ctx, () => {\n    ctx.fillStyle = 'rgba(0, 0, 0, 0)';\n    ctx.fillRect(0, 0, 1, 1);\n    twgl.setTextureFromElement(gl, textures.fromCanvas, canvas);\n  });\n\n  board.refreshCells();\n  setInterval(() => {\n    board.refreshCells();\n  }, 5000);\n\n  function render(time) {\n    twgl.resizeCanvasToDisplaySize(gl.canvas);\n    twgl.bindFramebufferInfo(gl, null);\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n\n    const uniforms = {\n      resolution: [gl.canvas.width, gl.canvas.height],\n      texSize: [TexSize - 1, TexSize - 1],\n      pos: [view.a, view.b, view.zoom],\n      u_diffuse: textures.fromCanvas,\n    };\n    gl.useProgram(programInfo.program);\n    twgl.setBuffersAndAttributes(gl, programInfo, bufferInfo);\n    twgl.setUniforms(programInfo, uniforms);\n    twgl.drawBufferInfo(gl, bufferInfo);\n\n    requestAnimationFrame(render);\n  }\n  requestAnimationFrame(render);\n\n  return board;\n}\n\nfunction dxdyToAb(dx, dy) {\n  const b = dy / DyB;\n  const a = (dx - b * DxB) / DxA;\n  return {\n    a, b,\n  }\n}\n\nfunction GlPage(props) {\n  const canvasEl = useRef(null);\n  const berryclub = props._near.contract;\n\n  const propsDraw = props.draw;\n  useEffect(() => {\n    isDrawMode = propsDraw;\n  }, [propsDraw]);\n\n  useEffect(() => {\n    if (canvasEl.current && berryclub) {\n      console.log(\"Setup\");\n      const ctx = canvasEl.current.getContext('webgl');\n\n      const drawNow = async (ab) => {\n        let a = (view.a + ab.a / view.zoom + 0.5) * TexSize - 0.5;\n        let b = (view.b + ab.b / view.zoom + 0.5) * TexSize - 0.5;\n\n        function dist(na, nb) {\n          const cy = ((nb - b) * DyB + (na - a) * DyA);\n          const cx = ((nb - b) * DxB + (na - a) * DxA);\n          return cx * cx + cy * cy;\n        }\n\n        const ta = Math.trunc(a);\n        const tb = Math.trunc(b);\n        let best = null;\n        let minD = 10;\n\n        for (let i = -1; i < 2 ; ++i) {\n          for (let j = -1; j < 2; ++j) {\n            const a = ta + i;\n            const b = tb + j;\n            const d = dist(a, b);\n            if (d < minD + 1e-9) {\n              best = {a, b};\n              minD = d;\n            }\n          }\n        }\n        board.draw(best);\n      }\n\n      const board = setupRender(berryclub, ctx);\n      canvasEl.current.addEventListener('mousemove', (e) => {\n        const x = e.clientX;\n        const y = e.clientY;\n        const rect = e.target.getBoundingClientRect();\n        const dx = ((x - rect.x) / rect.width - 0.5);\n        const dy = ((y - rect.y) / rect.width - rect.height / rect.width * 0.5);\n        const ab = dxdyToAb(dx, dy);\n        if ((e.buttons & 1) && isDrawMode) {\n          drawNow(ab);\n        } else if (lastMousePos && !isDrawMode) {\n          const dx = (x - lastMousePos.x) / rect.width;\n          const dy = (y - lastMousePos.y) / rect.width;\n          const {a, b} = dxdyToAb(dx, dy);\n          view = {\n            a: view.a - a / view.zoom,\n            b: view.b - b / view.zoom,\n            zoom: view.zoom,\n            aspect: view.aspect,\n          };\n        }\n        if (e.buttons & 1) {\n          lastMousePos = {x, y};\n        } else {\n          lastMousePos = null;\n        }\n      });\n\n\n      canvasEl.current.addEventListener('mousedown', (e) => {\n        if ((e.buttons & 1) && isDrawMode) {\n          const x = e.clientX;\n          const y = e.clientY;\n          const rect = e.target.getBoundingClientRect();\n          const dx = ((x - rect.x) / rect.width - 0.5);\n          const dy = ((y - rect.y) / rect.width - rect.height / rect.width * 0.5);\n          drawNow(dxdyToAb(dx, dy));\n        }\n      });\n\n      canvasEl.current.addEventListener('wheel', (e) => {\n        e.preventDefault();\n        const rect = e.target.getBoundingClientRect();\n        const dx = ((e.clientX - rect.x) / rect.width - 0.5);\n        const dy = ((e.clientY - rect.y) / rect.width - rect.height / rect.width * 0.5);\n        const mb = dy / DyB;\n        const ma = (dx - mb * DxB) / DxA;\n\n        const newZoom = Math.max(MinZoom, view.zoom * Math.exp(-e.deltaY * 0.001));\n        const oa = view.a + ma / view.zoom;\n        const ob = view.b + mb / view.zoom;\n        const va = oa - ma / newZoom;\n        const vb = ob - mb / newZoom;\n\n        view = {\n          a: va,\n          b: vb,\n          zoom: newZoom,\n          aspect: view.aspect,\n        };\n\n      });\n\n      const resize = () => {\n        const dpr = window.devicePixelRatio || 1;\n        const bsr = ctx.webkitBackingStorePixelRatio ||\n          ctx.mozBackingStorePixelRatio ||\n          ctx.msBackingStorePixelRatio ||\n          ctx.oBackingStorePixelRatio ||\n          ctx.backingStorePixelRatio || 1;\n\n        const pixelRatio = dpr / bsr;\n        const width  = window.innerWidth || document.documentElement.clientWidth ||\n          document.body.clientWidth;\n        const height = window.innerHeight|| document.documentElement.clientHeight||\n          document.body.clientHeight;\n        canvasEl.current.width = width * pixelRatio;\n        canvasEl.current.height = height * pixelRatio;\n        // ctx.scale(canvasEl.current.width, canvasEl.current.width);\n        view = Object.assign({}, view, {aspect: height / width})\n      };\n\n      window.addEventListener('resize', resize);\n\n      resize();\n\n    }\n  }, [canvasEl, berryclub])\n\n  return (\n    <div>\n      <canvas\n        ref={canvasEl}\n        className=\"canvas\"\n        width={640}\n      />\n    </div>\n  );\n}\n\nexport default GlPage;\n","export default `\nconst float Sq3 = sqrt(3.0) / 2.0;\nconst mat2 D = mat2(Sq3 * 2.0, Sq3, 0.0, -1.5);\n\nuniform vec2 resolution;\nuniform vec3 pos;\n\nattribute vec4 a_position;\nattribute vec2 a_texcoord;\nattribute vec2 a_ab;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_ab;\n\nvoid main() {\n  gl_Position = vec4((a_position.xy - pos.xy * D) * vec2(2.0, 2.0 * resolution.x / resolution.y) * pos.z, a_position.zw);\n  v_texCoord = a_texcoord;\n  v_ab = a_ab;\n}\n`;\n","export default `\nprecision highp float;\n\nconst float Sq3 = sqrt(3.0) / 2.0;\nconst mat2 D = mat2(Sq3 * 2.0, Sq3, 0.0, -1.5);\n\nuniform vec3 color;\nuniform sampler2D u_diffuse;\nuniform vec2 texSize;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_ab;\n\nfloat d(vec2 p) {\n  vec2 dx = (p - v_ab) * D;\n  return dot(dx, dx);\n}\n\nvec3 mind(vec3 a, vec2 b)\n{\n  float db = d(b); \n  return mix(vec3(b, db), a, step(a.z, db));\n}\n\nvoid main() {\n  vec2 fab = floor(v_ab);\n  vec3 best = vec3(fab, d(fab));\n  best = mind(best, fab + vec2(1.0, 0.0));\n  best = mind(best, fab + vec2(0.0, 1.0));\n  best = mind(best, fab + vec2(1.0, 1.0));\n  \n  vec4 diffuseColor = texture2D(u_diffuse, best.xy / texSize);\n  if (diffuseColor.w < 1.0) {\n    discard;\n  }\n  gl_FragColor = diffuseColor;\n}\n`;\n","import React from 'react';\nimport \"error-polyfill\";\nimport \"./App.scss\";\nimport './gh-fork-ribbon.css';\nimport * as nearAPI from 'near-api-js'\nimport ls from \"local-storage\";\nimport GlPage from \"./pages/GL\";\n\nconst IsMainnet = false; // window.location.hostname === \"berry.cards\";\nconst TestNearConfig = {\n  networkId: 'testnet',\n  nodeUrl: 'https://rpc.testnet.near.org',\n  archivalNodeUrl: 'https://rpc.mainnet.internal.near.org', // https://rpc.testnet.internal.near.org',\n  contractName: 'dev-1633114897352-65032726804099',\n  walletUrl: 'https://wallet.testnet.near.org',\n};\nconst MainNearConfig = {\n  networkId: 'mainnet',\n  nodeUrl: 'https://rpc.mainnet.near.org',\n  archivalNodeUrl: 'https://rpc.mainnet.internal.near.org',\n  contractName: 'dev-1633114897352-65032726804099',\n  walletUrl: 'https://wallet.near.org',\n};\n\nconst NearConfig = IsMainnet ? MainNearConfig : TestNearConfig;\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this._near = {};\n\n    this._near.lsKey = NearConfig.contractName + ':v01:';\n    this._near.lsKeyRecentCards = this._near.lsKey + \"recentCards\";\n\n    this.state = {\n      connected: false,\n      draw: false,\n      isNavCollapsed: true,\n      account: null,\n      requests: null,\n      recentCards: ls.get(this._near.lsKeyRecentCards) || [],\n    };\n\n    this._initNear().then(() => {\n      this.setState({\n        signedIn: !!this._near.accountId,\n        signedAccountId: this._near.accountId,\n        connected: true,\n      });\n    });\n  }\n\n\n  async _initNear() {\n    const keyStore = new nearAPI.keyStores.BrowserLocalStorageKeyStore();\n    const near = await nearAPI.connect(Object.assign({deps: {keyStore}}, NearConfig));\n    this._near.archivalConnection = nearAPI.Connection.fromConfig({\n      networkId: NearConfig.networkId,\n      provider: { type: 'JsonRpcProvider', args: { url: NearConfig.archivalNodeUrl } },\n      signer: { type: 'InMemorySigner', keyStore }\n    });\n    this._near.keyStore = keyStore;\n    this._near.near = near;\n\n    this._near.walletConnection = new nearAPI.WalletConnection(near, NearConfig.contractName);\n    this._near.accountId = this._near.walletConnection.getAccountId();\n\n    this._near.account = this._near.walletConnection.account();\n\n\n    this._near.berryclub = new nearAPI.Account(this._near.archivalConnection, 'berryclub.ek.near');\n\n    this._near.contract = new nearAPI.Contract(this._near.account, NearConfig.contractName, {\n      viewMethods: ['get_cells_json', 'get_storage_balance'],\n      changeMethods: ['draw_json'],\n    });\n\n  }\n\n  async requestSignIn(e) {\n    e && e.preventDefault();\n    const appTitle = '';\n    await this._near.walletConnection.requestSignIn(\n      NearConfig.contractName,\n      appTitle\n    )\n    return false;\n  }\n\n  async logOut() {\n    this._near.walletConnection.signOut();\n    this._near.accountId = null;\n    this.setState({\n      signedIn: !!this._accountId,\n      signedAccountId: this._accountId,\n    })\n  }\n\n  popRequest(c) {\n    const requests = this.state.requests.slice(1);\n    this.setState({\n      requests,\n    }, c);\n  }\n\n  addRequest(r, c) {\n    const requests = this.state.requests.slice(0);\n    requests.push(r);\n    this.setState({\n      requests,\n    }, c);\n  }\n\n  addRecentCard(cardId) {\n    let recentCards = this.state.recentCards.slice(0);\n    const index = recentCards.indexOf(cardId);\n    if (index !== -1) {\n      recentCards.splice(index, 1);\n    }\n    recentCards.unshift(cardId);\n    recentCards = recentCards.slice(0, 5);\n    ls.set(this._near.lsKeyRecentCards, recentCards);\n    this.setState({\n      recentCards\n    })\n  }\n\n  async refreshAllowance() {\n    alert(\"You're out of access key allowance. Need sign in again to refresh it\");\n    await this.logOut();\n    await this.requestSignIn();\n  }\n\n  render() {\n    const passProps = {\n      _near: this._near,\n      updateState: (s, c) => this.setState(s, c),\n      popRequest: (c) => this.popRequest(c),\n      addRequest: (r, c) => this.addRequest(r, c),\n      addRecentCard: (cardId) => this.addRecentCard(cardId),\n      refreshAllowance: () => this.refreshAllowance(),\n      ...this.state\n    };\n    const header = !this.state.connected ? (\n      <div>Connecting... <span className=\"spinner-grow spinner-grow-sm\" role=\"status\" aria-hidden=\"true\"></span></div>\n    ) : (this.state.signedIn ? (\n      <div>\n        <button onClick={() => this.setState({ draw: !this.state.draw})}>{!this.state.draw ? \"Scroll mode\" : \"Draw mode\"}</button>\n\n        <button\n          className=\"btn btn-outline-secondary\" style={{float: \"right\"}}\n          onClick={() => this.logOut()}>Sign out ({this.state.signedAccountId})</button>\n      </div>\n    ) : (\n      <div>\n        <button\n          className=\"btn btn-primary\"\n          onClick={(e) => this.requestSignIn(e)}>Sign in with NEAR Wallet</button>\n      </div>\n    ));\n\n    return (\n      <div className=\"App\">\n        {header}\n        <a className=\"github-fork-ribbon right-bottom fixed\" href=\"https://github.com/evgenykuzyakov/hexland\" data-ribbon=\"Fork me on GitHub\"\n           title=\"Fork me on GitHub\">Fork me on GitHub</a>\n\n        <GlPage {...passProps}/>\n      </div>\n    )\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}