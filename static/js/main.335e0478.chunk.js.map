{"version":3,"sources":["pages/Home.js","App.js","index.js"],"names":["lastMousePos","Sq3","Math","sqrt","DxA","DxB","drawHex","ctx","cx","cy","side","color","fillStyle","beginPath","moveTo","lineTo","fill","HomePage","props","canvasEl","useRef","useState","setCtx","a","b","zoom","aspect","view","setView","mouseAb","setMouseAb","refresh","useCallback","height","maxA","maxB","db","da","oa","ob","a1","floor","a2","ceil","b1","b2","clearRect","font","textAlign","textBaseline","ia","dist","na","nb","ta","trunc","tb","best","minD","i","j","d","useEffect","current","getContext","addEventListener","e","x","clientX","y","clientY","rect","target","getBoundingClientRect","dx","width","buttons","preventDefault","mb","ma","newZoom","max","exp","deltaY","resize","pixelRatio","window","devicePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","innerWidth","document","documentElement","clientWidth","body","innerHeight","clientHeight","scale","v","Object","assign","ref","className","NearConfig","location","hostname","networkId","nodeUrl","archivalNodeUrl","contractName","walletUrl","App","_near","lsKey","lsKeyRecentCards","state","connected","isNavCollapsed","account","requests","recentCards","ls","get","_initNear","then","setState","signedIn","accountId","signedAccountId","keyStore","nearAPI","BrowserLocalStorageKeyStore","deps","near","this","walletConnection","getAccountId","contract","viewMethods","changeMethods","requestSignIn","signOut","_accountId","c","slice","r","push","cardId","index","indexOf","splice","unshift","set","alert","logOut","passProps","updateState","s","popRequest","addRequest","addRecentCard","refreshAllowance","href","data-ribbon","title","React","Component","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.335e0478.chunk.js","sourcesContent":["import \"./Home.scss\";\nimport React, {useCallback, useEffect, useRef, useState} from 'react';\n\nlet lastMousePos = null;\nconst Sq3 = Math.sqrt(3.0) / 2;\nconst DxA = Sq3 * 2;\nconst DyA = 0;\nconst DxB = Sq3;\nconst DyB = 1.5;\n\nconst InitialZoom = 1 / 30;\nconst MinZoom = 1 / 256;\n\n\nfunction drawHex(ctx, cx, cy, side, color) {\n  // `rgb(${((i * 16 % 256) + 256) % 256}, ${((j * 16 % 256) + 256) % 256},${(((i + 13 + j * 17) % 256) + 256) % 256})`\n  ctx.fillStyle = color;\n  ctx.beginPath();\n  ctx.moveTo(cx, cy - side);\n  ctx.lineTo(cx - Sq3 * side, cy - side / 2);\n  ctx.lineTo(cx - Sq3 * side, cy + side / 2);\n  ctx.lineTo(cx, cy + side);\n  ctx.lineTo( cx + Sq3 * side, cy + side / 2);\n  ctx.lineTo(cx + Sq3 * side, cy - side / 2);\n  ctx.fill();\n}\n\nfunction HomePage(props) {\n  const canvasEl = useRef(null);\n  const [ctx, setCtx] = useState(null);\n  const [view, setView] = useState({\n    a: 0,\n    b: 0,\n    zoom: InitialZoom,\n    aspect: 1,\n  });\n  const [mouseAb, setMouseAb] = useState({a: 0, b: 0});\n\n  const refresh = useCallback(() => {\n    let width = 1;\n    let height = view.aspect;\n    const zoom = view.zoom;\n    let maxA = width / zoom / DxA;\n    let maxB = height / zoom / DyB;\n\n    const db = height / zoom / DyB / 2;\n    const da = (width / zoom / 2 - db * DxB) / DxA;\n\n    const oa = view.a - da;\n    const ob = view.b - db;\n\n    let a1 = Math.floor(oa);\n    let a2 = Math.ceil(oa + maxA);\n    let b1 = Math.floor(ob);\n    let b2 = Math.floor(ob + maxB + 1);\n\n    ctx.clearRect(0, 0, width, height);\n    ctx.font = `${zoom / 3}px serif`;\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    for (let b = b1; b <= b2; ++b) {\n      for (let ia = a1; ia <= a2; ++ia) {\n        const a = ia - Math.floor((b - b1) / 2);\n        const cy = ((b - ob) * DyB + (a - oa) * DyA) * zoom;\n        const cx = ((b - ob) * DxB + (a - oa) * DxA) * zoom;\n        drawHex(\n          ctx,\n          cx,\n          cy,\n          zoom,\n          `rgb(${((a * 16 % 256) + 256) % 256}, ${((b * 16 % 256) + 256) % 256},${(((a + 13 + b * 17) % 256) + 256) % 256})`\n        );\n        // ctx.fillStyle = 'white';\n        // ctx.fillText(`${a}, ${b}`, cx, cy);\n      }\n    }\n\n    if (mouseAb) {\n      let a = view.a + mouseAb.a / zoom;\n      let b = view.b + mouseAb.b / zoom;\n\n      function dist(na, nb) {\n        const cy = ((nb - b) * DyB + (na - a) * DyA);\n        const cx = ((nb - b) * DxB + (na - a) * DxA);\n        return cx * cx + cy * cy;\n      }\n\n      const ta = Math.trunc(a);\n      const tb = Math.trunc(b);\n      let best = null;\n      let minD = 10;\n\n      for (let i = -1; i < 2 ; ++i) {\n        for (let j = -1; j < 2; ++j) {\n          const a = ta + i;\n          const b = tb + j;\n          const d = dist(a, b);\n          if (d < minD + 1e-9) {\n            best = {a, b};\n            minD = d;\n          }\n        }\n      }\n\n      a = best.a;\n      b = best.b;\n\n      const cy = ((b - ob) * DyB + (a - oa) * DyA) * zoom;\n      const cx = ((b - ob) * DxB + (a - oa) * DxA) * zoom;\n      drawHex(\n        ctx,\n        cx,\n        cy,\n        zoom,\n        'rgba(0, 0, 0, 0.25)'\n      );\n    }\n\n  }, [ctx, view, mouseAb])\n\n  useEffect(() => {\n    if (ctx) {\n      refresh();\n    }\n  }, [mouseAb, view, ctx, refresh])\n\n  useEffect(() => {\n    if (canvasEl.current) {\n      const ctx = canvasEl.current.getContext('2d');\n      setCtx(ctx);\n      canvasEl.current.addEventListener('mousemove', (e) => {\n        const x = e.clientX;\n        const y = e.clientY;\n        const rect = e.target.getBoundingClientRect();\n        const dx = ((e.clientX - rect.x) / rect.width - 0.5);\n        const dy = ((e.clientY - rect.y) / rect.width - rect.height / rect.width * 0.5);\n        const b = dy / DyB;\n        const a = (dx - b * DxB) / DxA;\n        setMouseAb({\n          a, b\n        })\n        if (lastMousePos) {\n          const dx = (x - lastMousePos.x) / rect.width;\n          const dy = (y - lastMousePos.y) / rect.width;\n          const db = dy / DyB;\n          const da = (dx - db * DxB) / DxA;\n          setView((view) => {\n            return {\n              a: view.a - da / view.zoom,\n              b: view.b - db / view.zoom,\n              zoom: view.zoom,\n              aspect: view.aspect,\n            }\n          })\n        }\n        if (e.buttons & 1) {\n          lastMousePos = {x, y};\n        } else {\n          lastMousePos = null;\n        }\n      });\n\n      canvasEl.current.addEventListener('wheel', (e) => {\n        e.preventDefault();\n        const rect = e.target.getBoundingClientRect();\n        const dx = ((e.clientX - rect.x) / rect.width - 0.5);\n        const dy = ((e.clientY - rect.y) / rect.width - rect.height / rect.width * 0.5);\n        const mb = dy / DyB;\n        const ma = (dx - mb * DxB) / DxA;\n        setView((view) => {\n          const newZoom = Math.max(MinZoom, view.zoom * Math.exp(-e.deltaY * 0.001));\n          const oa = view.a + ma / view.zoom;\n          const ob = view.b + mb / view.zoom;\n          const va = oa - ma / newZoom;\n          const vb = ob - mb / newZoom;\n\n          return {\n            a: va,\n            b: vb,\n            zoom: newZoom,\n            aspect: view.aspect,\n          }\n        })\n      });\n\n      const resize = () => {\n        const dpr = window.devicePixelRatio || 1;\n        const bsr = ctx.webkitBackingStorePixelRatio ||\n          ctx.mozBackingStorePixelRatio ||\n          ctx.msBackingStorePixelRatio ||\n          ctx.oBackingStorePixelRatio ||\n          ctx.backingStorePixelRatio || 1;\n\n        const pixelRatio = dpr / bsr;\n        const width  = window.innerWidth || document.documentElement.clientWidth ||\n          document.body.clientWidth;\n        const height = window.innerHeight|| document.documentElement.clientHeight||\n          document.body.clientHeight;\n        canvasEl.current.width = width * pixelRatio;\n        canvasEl.current.height = height * pixelRatio;\n        ctx.scale(canvasEl.current.width, canvasEl.current.width);\n        setView((v) => Object.assign({}, v, {aspect: height / width}));\n      };\n\n      window.addEventListener('resize', resize);\n\n      resize();\n\n    }\n  }, [canvasEl])\n\n  return (\n    <div>\n      <canvas\n        ref={canvasEl}\n        className=\"canvas\"\n        width={640}\n      />\n    </div>\n  );\n}\n\nexport default HomePage;\n","import React from 'react';\nimport \"error-polyfill\";\nimport 'bootstrap/dist/js/bootstrap.bundle';\n// import 'bootstrap/dist/css/bootstrap.min.css';\nimport \"./App.scss\";\nimport './gh-fork-ribbon.css';\nimport * as nearAPI from 'near-api-js'\nimport HomePage from \"./pages/Home\";\nimport {HashRouter as Router, Link, Route, Switch} from 'react-router-dom'\nimport ls from \"local-storage\";\n\nconst IsMainnet = window.location.hostname === \"berry.cards\";\nconst TestNearConfig = {\n  networkId: 'testnet',\n  nodeUrl: 'https://rpc.testnet.near.org',\n  archivalNodeUrl: 'https://rpc.testnet.internal.near.org',\n  contractName: 'dev-1614796345972-8721304',\n  walletUrl: 'https://wallet.testnet.near.org',\n};\nconst MainNearConfig = {\n  networkId: 'mainnet',\n  nodeUrl: 'https://rpc.mainnet.near.org',\n  archivalNodeUrl: 'https://rpc.mainnet.internal.near.org',\n  contractName: 'cards.berryclub.ek.near',\n  walletUrl: 'https://wallet.near.org',\n};\n\nconst NearConfig = IsMainnet ? MainNearConfig : TestNearConfig;\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this._near = {};\n\n    this._near.lsKey = NearConfig.contractName + ':v01:';\n    this._near.lsKeyRecentCards = this._near.lsKey + \"recentCards\";\n\n    this.state = {\n      connected: false,\n      isNavCollapsed: true,\n      account: null,\n      requests: null,\n      recentCards: ls.get(this._near.lsKeyRecentCards) || [],\n    };\n\n    this._initNear().then(() => {\n      this.setState({\n        signedIn: !!this._near.accountId,\n        signedAccountId: this._near.accountId,\n        connected: true,\n      });\n    });\n  }\n\n\n  async _initNear() {\n    const keyStore = new nearAPI.keyStores.BrowserLocalStorageKeyStore();\n    const near = await nearAPI.connect(Object.assign({deps: {keyStore}}, NearConfig));\n    this._near.keyStore = keyStore;\n    this._near.near = near;\n\n    this._near.walletConnection = new nearAPI.WalletConnection(near, NearConfig.contractName);\n    this._near.accountId = this._near.walletConnection.getAccountId();\n\n    this._near.account = this._near.walletConnection.account();\n    this._near.contract = new nearAPI.Contract(this._near.account, NearConfig.contractName, {\n      viewMethods: ['get_account', 'get_num_accounts', 'get_accounts', 'get_num_cards', 'get_top', 'get_rating', 'get_trade_data', 'get_card_info', 'get_account_cards'],\n      changeMethods: ['register_account', 'vote', 'buy_card'],\n    });\n\n  }\n\n  async requestSignIn(e) {\n    e && e.preventDefault();\n    const appTitle = 'Berry Cards';\n    await this._near.walletConnection.requestSignIn(\n      NearConfig.contractName,\n      appTitle\n    )\n    return false;\n  }\n\n  async logOut() {\n    this._near.walletConnection.signOut();\n    this._near.accountId = null;\n    this.setState({\n      signedIn: !!this._accountId,\n      signedAccountId: this._accountId,\n    })\n  }\n\n  popRequest(c) {\n    const requests = this.state.requests.slice(1);\n    this.setState({\n      requests,\n    }, c);\n  }\n\n  addRequest(r, c) {\n    const requests = this.state.requests.slice(0);\n    requests.push(r);\n    this.setState({\n      requests,\n    }, c);\n  }\n\n  addRecentCard(cardId) {\n    let recentCards = this.state.recentCards.slice(0);\n    const index = recentCards.indexOf(cardId);\n    if (index !== -1) {\n      recentCards.splice(index, 1);\n    }\n    recentCards.unshift(cardId);\n    recentCards = recentCards.slice(0, 5);\n    ls.set(this._near.lsKeyRecentCards, recentCards);\n    this.setState({\n      recentCards\n    })\n  }\n\n  async refreshAllowance() {\n    alert(\"You're out of access key allowance. Need sign in again to refresh it\");\n    await this.logOut();\n    await this.requestSignIn();\n  }\n\n  render() {\n    const passProps = {\n      _near: this._near,\n      updateState: (s, c) => this.setState(s, c),\n      popRequest: (c) => this.popRequest(c),\n      addRequest: (r, c) => this.addRequest(r, c),\n      addRecentCard: (cardId) => this.addRecentCard(cardId),\n      refreshAllowance: () => this.refreshAllowance(),\n      ...this.state\n    };\n    const header = !this.state.connected ? (\n      <div>Connecting... <span className=\"spinner-grow spinner-grow-sm\" role=\"status\" aria-hidden=\"true\"></span></div>\n    ) : (this.state.signedIn ? (\n      <div>\n        <button\n          className=\"btn btn-outline-secondary\"\n          onClick={() => this.logOut()}>Sign out ({this.state.signedAccountId})</button>\n      </div>\n    ) : (\n      <div>\n        <button\n          className=\"btn btn-primary\"\n          onClick={(e) => this.requestSignIn(e)}>Sign in with NEAR Wallet</button>\n      </div>\n    ));\n\n    return (\n      <div className=\"App\">\n        <a className=\"github-fork-ribbon right-bottom fixed\" href=\"https://github.com/evgenykuzyakov/berry-hot\" data-ribbon=\"Fork me on GitHub\"\n           title=\"Fork me on GitHub\">Fork me on GitHub</a>\n\n        <HomePage {...passProps}/>\n      </div>\n    )\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}