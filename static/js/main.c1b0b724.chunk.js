(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{100:function(e,t,n){e.exports=n(190)},105:function(e,t,n){},124:function(e,t,n){},125:function(e,t,n){},130:function(e,t){},138:function(e,t){},154:function(e,t){},156:function(e,t){},183:function(e,t,n){},190:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(93),o=n.n(c),i=(n(105),n(98)),s=n(1),l=n.n(s),u=n(29),d=n(94),m=n(95),h=n(99),f=n(97),g=(n(55),n(122),n(123),n(124),n(125),n(30)),v=n(38),b=(n(183),null),p=Math.sqrt(3)/2,w=2*p,E=p;function y(e,t,n,a,r){e.fillStyle=r,e.beginPath(),e.moveTo(t,n-a),e.lineTo(t-p*a,n-a/2),e.lineTo(t-p*a,n+a/2),e.lineTo(t,n+a),e.lineTo(t+p*a,n+a/2),e.lineTo(t+p*a,n-a/2),e.fill()}var _=function(e){var t=Object(a.useRef)(null),n=Object(a.useState)(null),c=Object(v.a)(n,2),o=c[0],i=c[1],s=Object(a.useState)({a:0,b:0,zoom:32}),l=Object(v.a)(s,2),u=l[0],d=l[1],m=Object(a.useState)({a:0,b:0}),h=Object(v.a)(m,2),f=h[0],g=h[1],p=Object(a.useCallback)((function(){var e=640/u.zoom/w,t=480/u.zoom/1.5,n=480/u.zoom/1.5/2,a=(640/u.zoom/2-n*E)/w,r=u.a-a,c=u.b-n,i=Math.floor(r),s=Math.ceil(r+e),l=Math.floor(c),d=Math.floor(c+t+1);o.clearRect(0,0,640,480),o.font="".concat(u.zoom/3,"px serif"),o.textAlign="center",o.textBaseline="middle";for(var m=l;m<=d;++m)for(var h=i;h<=s;++h){var g=h-Math.floor((m-l)/2),v=(1.5*(m-c)+0*(g-r))*u.zoom,b=((m-c)*E+(g-r)*w)*u.zoom;y(o,b,v,u.zoom,"rgb(".concat((16*g%256+256)%256,", ").concat((16*m%256+256)%256,",").concat(((g+13+17*m)%256+256)%256,")")),o.fillStyle="white",o.fillText("".concat(g,", ").concat(m),b,v)}if(f){for(var p=function(e,t){var n=1.5*(t-k)+0*(e-_),a=(t-k)*E+(e-_)*w;return a*a+n*n},_=u.a+f.a/u.zoom,k=u.b+f.b/u.zoom,N=Math.trunc(_),C=Math.trunc(k),x=null,S=10,z=-1;z<2;++z)for(var O=-1;O<2;++O){var R=N+z,I=C+O,j=p(R,I);j<S+1e-9&&(x={a:R,b:I},S=j)}_=x.a;var q=(1.5*((k=x.b)-c)+0*(_-r))*u.zoom,B=((k-c)*E+(_-r)*w)*u.zoom;y(o,B,q,u.zoom,"rgba(0, 0, 0, 0.25)")}}),[o,u,f]);return Object(a.useEffect)((function(){o&&p()}),[f,u,o,p]),Object(a.useEffect)((function(){if(t.current){var e=t.current.getContext("2d");i(e),t.current.addEventListener("mousemove",(function(e){var t=e.clientX,n=e.clientY,a=e.target.getBoundingClientRect(),r=640*((e.clientX-a.x)/a.width-.5),c=480*((e.clientY-a.y)/a.height-.5)/1.5;if(g({a:(r-c*E)/w,b:c}),b){var o=(t-b.x)/a.width*640,i=(n-b.y)/a.height*480/1.5,s=(o-i*E)/w;d((function(e){return{a:e.a-s/e.zoom,b:e.b-i/e.zoom,zoom:e.zoom}}))}b=1&e.buttons?{x:t,y:n}:null})),t.current.addEventListener("wheel",(function(e){e.preventDefault();var t=e.target.getBoundingClientRect(),n=640*((e.clientX-t.x)/t.width-.5),a=480*((e.clientY-t.y)/t.height-.5)/1.5,r=(n-a*E)/w;d((function(t){var n=Math.max(8,t.zoom-.1*e.deltaY),c=t.a+r/t.zoom,o=t.b+a/t.zoom;return{a:c-r/n,b:o-a/n,zoom:n}}))}));var n=function(){var n=(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),a=t.current.getBoundingClientRect();t.current.width=a.width*n,t.current.height=a.height*n,e.scale(t.current.width/640,t.current.height/480),d((function(e){return Object.assign({},e)}))};window.addEventListener("resize",n),n()}}),[t]),r.a.createElement("div",null,r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row justify-content-md-center mb-3"},r.a.createElement("div",null,u.a," ",u.b," ",u.zoom),r.a.createElement("canvas",{ref:t,className:"canvas",width:640,height:480}))))},k=n(19),N=n(3),C=n(51),x=n.n(C),S="berry.cards"===window.location.hostname?{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",archivalNodeUrl:"https://rpc.mainnet.internal.near.org",contractName:"cards.berryclub.ek.near",walletUrl:"https://wallet.near.org"}:{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",archivalNodeUrl:"https://rpc.testnet.internal.near.org",contractName:"dev-1614796345972-8721304",walletUrl:"https://wallet.testnet.near.org"},z=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e))._near={},a._near.lsKey=S.contractName+":v01:",a._near.lsKeyRecentCards=a._near.lsKey+"recentCards",a.state={connected:!1,isNavCollapsed:!0,account:null,requests:null,recentCards:x.a.get(a._near.lsKeyRecentCards)||[]},a._initNear().then((function(){a.setState({signedIn:!!a._near.accountId,signedAccountId:a._near.accountId,connected:!0})})),a}return Object(m.a)(n,[{key:"_initNear",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new g.keyStores.BrowserLocalStorageKeyStore,e.next=3,g.connect(Object.assign({deps:{keyStore:t}},S));case 3:n=e.sent,this._near.keyStore=t,this._near.near=n,this._near.walletConnection=new g.WalletConnection(n,S.contractName),this._near.accountId=this._near.walletConnection.getAccountId(),this._near.account=this._near.walletConnection.account(),this._near.contract=new g.Contract(this._near.account,S.contractName,{viewMethods:["get_account","get_num_accounts","get_accounts","get_num_cards","get_top","get_rating","get_trade_data","get_card_info","get_account_cards"],changeMethods:["register_account","vote","buy_card"]});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestSignIn",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&t.preventDefault(),"Berry Cards",e.next=4,this._near.walletConnection.requestSignIn(S.contractName,"Berry Cards");case 4:return e.abrupt("return",!1);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"logOut",value:function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._near.walletConnection.signOut(),this._near.accountId=null,this.setState({signedIn:!!this._accountId,signedAccountId:this._accountId});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"popRequest",value:function(e){var t=this.state.requests.slice(1);this.setState({requests:t},e)}},{key:"addRequest",value:function(e,t){var n=this.state.requests.slice(0);n.push(e),this.setState({requests:n},t)}},{key:"addRecentCard",value:function(e){var t=this.state.recentCards.slice(0),n=t.indexOf(e);-1!==n&&t.splice(n,1),t.unshift(e),t=t.slice(0,5),x.a.set(this._near.lsKeyRecentCards,t),this.setState({recentCards:t})}},{key:"refreshAllowance",value:function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert("You're out of access key allowance. Need sign in again to refresh it"),e.next=3,this.logOut();case 3:return e.next=5,this.requestSignIn();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=Object(i.a)({_near:this._near,updateState:function(t,n){return e.setState(t,n)},popRequest:function(t){return e.popRequest(t)},addRequest:function(t,n){return e.addRequest(t,n)},addRecentCard:function(t){return e.addRecentCard(t)},refreshAllowance:function(){return e.refreshAllowance()}},this.state),n=this.state.connected?this.state.signedIn?r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-outline-secondary",onClick:function(){return e.logOut()}},"Sign out (",this.state.signedAccountId,")")):r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-primary",onClick:function(t){return e.requestSignIn(t)}},"Sign in with NEAR Wallet")):r.a.createElement("div",null,"Connecting... ",r.a.createElement("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}));return r.a.createElement("div",{className:"App"},r.a.createElement(k.a,{basename:"/hexland"},r.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light mb-3"},r.a.createElement("div",{className:"container-fluid"},r.a.createElement(k.b,{className:"navbar-brand",to:"/",title:"NEAR.fm"},"[BETA] Berry Cards"),r.a.createElement("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},r.a.createElement("span",{className:"navbar-toggler-icon"})),r.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent"},r.a.createElement("ul",{className:"navbar-nav me-auto mb-2 mb-lg-0"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(k.b,{className:"nav-link","aria-current":"page",to:"/"},"Home")),this.state.signedIn&&r.a.createElement("li",{className:"nav-item"},r.a.createElement(k.b,{className:"nav-link","aria-current":"page",to:"/discover"},"Discover")),this.state.signedIn&&r.a.createElement("li",{className:"nav-item"},r.a.createElement(k.b,{className:"nav-link","aria-current":"page",to:"/a/".concat(this.state.signedAccountId)},"Profile")),r.a.createElement("li",{className:"nav-item"},r.a.createElement(k.b,{className:"nav-link","aria-current":"page",to:"/stats"},"Stats"))),r.a.createElement("form",{className:"d-flex"},n)))),r.a.createElement("a",{className:"github-fork-ribbon right-bottom fixed",href:"https://github.com/evgenykuzyakov/berry-hot","data-ribbon":"Fork me on GitHub",title:"Fork me on GitHub"},"Fork me on GitHub"),r.a.createElement(N.c,null,r.a.createElement(N.a,{exact:!0,path:"/"},r.a.createElement(_,t)))))}}]),n}(r.a.Component);o.a.render(r.a.createElement(z,null),document.getElementById("root"))}},[[100,1,2]]]);
//# sourceMappingURL=main.c1b0b724.chunk.js.map