(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{112:function(e,t,n){},113:function(e,t,n){},118:function(e,t){},126:function(e,t){},142:function(e,t){},144:function(e,t){},173:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(83),c=n.n(o),i=(n(94),n(87)),s=n(1),u=n.n(s),l=n(23),d=n(84),h=n(85),f=n(88),m=n(86),v=(n(45),n(111),n(112),n(113),n(24)),p=n(11);n(81),Math.sqrt(3);var g=n(43),b=n.n(g),w=n(14),_=null,y=Math.sqrt(3)/2,k=2*y,x=y;var C={hexes:[]};var S=function(e){var t=Object(a.useRef)(null),n=Object(a.useState)(null),o=Object(p.a)(n,2),c=o[0],i=o[1],s=Object(a.useState)({a:0,b:0,zoom:1/30,aspect:1}),u=Object(p.a)(s,2),l=u[0],d=u[1],h=Object(a.useState)({a:0,b:0}),f=Object(p.a)(h,2),m=f[0],v=f[1],g=Object(a.useCallback)((function(){for(var e=l.aspect,t=l.zoom,n=1/t/k,a=e/t/1.5,r=e/t/1.5/2,o=(1/t/2-r*x)/k,c=l.a-o,i=l.b-r,s=Math.floor(c),u=Math.ceil(c+n),d=Math.floor(i),h=Math.floor(i+a+1),f=[],m=d;m<=h;++m)for(var v=s;v<=u;++v){var p=v-Math.floor((m-d)/2);f.push({a:p,b:m,color:[(16*p%256+256)%256/255,(16*m%256+256)%256/255,(p+13+17*m+256)%256/255]})}Object.assign(C,{hexes:f,zoom:t,oa:c,ob:i})}),[c,l,m]);return Object(a.useEffect)((function(){c&&g()}),[m,l,c,g]),Object(a.useEffect)((function(){if(t.current){var e=t.current.getContext("webgl");i(e),function(e){var t=w.createProgramInfo(e,["\n\nconst float Sq3 = sqrt(3.0) / 2.0;\nconst mat2 D = mat2(Sq3 * 2.0, Sq3, 0.0, -1.5);\n\nattribute vec4 position;\nuniform vec2 resolution;\nuniform vec2 pos;\nuniform float zoom;\nuniform vec2 offset;\n\nvoid main() {\n  vec2 c = (pos - offset) * D;\n  gl_Position = vec4((position.xy + c) * vec2(2.0, 2.0 * resolution.x / resolution.y) * zoom - vec2(1.0, -1.0), position.zw);\n}\n","\nprecision mediump float;\n\nuniform vec3 color;\n\nvoid main() {\n  gl_FragColor = vec4( color, 1.0 );\n}\n"]),n={position:[0,0,0,0,-1,0,-y,-.5,0,0,0,0,-y,-.5,0,-y,.5,0,0,0,0,-y,.5,0,0,1,0,0,0,0,0,1,0,y,.5,0,0,0,0,y,.5,0,y,-.5,0,0,0,0,y,-.5,0,0,-1,0]},a=w.createBufferInfoFromArrays(e,n);requestAnimationFrame((function n(r){w.resizeCanvasToDisplaySize(e.canvas),e.viewport(0,0,e.canvas.width,e.canvas.height);var o={resolution:[e.canvas.width,e.canvas.height],zoom:C.zoom,offset:[C.oa,C.ob]};e.useProgram(t.program),w.setBuffersAndAttributes(e,t,a),C.hexes.forEach((function(n){var r=n.a,c=n.b,i=n.color;o.color=i,o.pos=[r,c],w.setUniforms(t,o),w.drawBufferInfo(e,a)})),requestAnimationFrame(n)}))}(e),t.current.addEventListener("mousemove",(function(e){var t=e.clientX,n=e.clientY,a=e.target.getBoundingClientRect(),r=(e.clientX-a.x)/a.width-.5,o=((e.clientY-a.y)/a.width-a.height/a.width*.5)/1.5;if(v({a:(r-o*x)/k,b:o}),_){var c=(t-_.x)/a.width,i=(n-_.y)/a.width/1.5,s=(c-i*x)/k;d((function(e){return{a:e.a-s/e.zoom,b:e.b-i/e.zoom,zoom:e.zoom,aspect:e.aspect}}))}_=1&e.buttons?{x:t,y:n}:null})),t.current.addEventListener("wheel",(function(e){e.preventDefault();var t=e.target.getBoundingClientRect(),n=(e.clientX-t.x)/t.width-.5,a=((e.clientY-t.y)/t.width-t.height/t.width*.5)/1.5,r=(n-a*x)/k;d((function(t){var n=Math.max(1/256,t.zoom*Math.exp(.001*-e.deltaY)),o=t.a+r/t.zoom,c=t.b+a/t.zoom;return{a:o-r/n,b:c-a/n,zoom:n,aspect:t.aspect}}))}));var n=function(){var n=(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,r=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;t.current.width=a*n,t.current.height=r*n,d((function(e){return Object.assign({},e,{aspect:r/a})}))};window.addEventListener("resize",n),n()}}),[t]),r.a.createElement("div",null,r.a.createElement("canvas",{ref:t,className:"canvas",width:640}))},O="berry.cards"===window.location.hostname?{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",archivalNodeUrl:"https://rpc.mainnet.internal.near.org",contractName:"cards.berryclub.ek.near",walletUrl:"https://wallet.near.org"}:{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",archivalNodeUrl:"https://rpc.testnet.internal.near.org",contractName:"dev-1614796345972-8721304",walletUrl:"https://wallet.testnet.near.org"},j=function(e){Object(f.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e))._near={},a._near.lsKey=O.contractName+":v01:",a._near.lsKeyRecentCards=a._near.lsKey+"recentCards",a.state={connected:!1,isNavCollapsed:!0,account:null,requests:null,recentCards:b.a.get(a._near.lsKeyRecentCards)||[]},a._initNear().then((function(){a.setState({signedIn:!!a._near.accountId,signedAccountId:a._near.accountId,connected:!0})})),a}return Object(h.a)(n,[{key:"_initNear",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new v.keyStores.BrowserLocalStorageKeyStore,e.next=3,v.connect(Object.assign({deps:{keyStore:t}},O));case 3:n=e.sent,this._near.keyStore=t,this._near.near=n,this._near.walletConnection=new v.WalletConnection(n,O.contractName),this._near.accountId=this._near.walletConnection.getAccountId(),this._near.account=this._near.walletConnection.account(),this._near.contract=new v.Contract(this._near.account,O.contractName,{viewMethods:["get_account","get_num_accounts","get_accounts","get_num_cards","get_top","get_rating","get_trade_data","get_card_info","get_account_cards"],changeMethods:["register_account","vote","buy_card"]});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestSignIn",value:function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&t.preventDefault(),"Berry Cards",e.next=4,this._near.walletConnection.requestSignIn(O.contractName,"Berry Cards");case 4:return e.abrupt("return",!1);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"logOut",value:function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._near.walletConnection.signOut(),this._near.accountId=null,this.setState({signedIn:!!this._accountId,signedAccountId:this._accountId});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"popRequest",value:function(e){var t=this.state.requests.slice(1);this.setState({requests:t},e)}},{key:"addRequest",value:function(e,t){var n=this.state.requests.slice(0);n.push(e),this.setState({requests:n},t)}},{key:"addRecentCard",value:function(e){var t=this.state.recentCards.slice(0),n=t.indexOf(e);-1!==n&&t.splice(n,1),t.unshift(e),t=t.slice(0,5),b.a.set(this._near.lsKeyRecentCards,t),this.setState({recentCards:t})}},{key:"refreshAllowance",value:function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert("You're out of access key allowance. Need sign in again to refresh it"),e.next=3,this.logOut();case 3:return e.next=5,this.requestSignIn();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=Object(i.a)({_near:this._near,updateState:function(t,n){return e.setState(t,n)},popRequest:function(t){return e.popRequest(t)},addRequest:function(t,n){return e.addRequest(t,n)},addRecentCard:function(t){return e.addRecentCard(t)},refreshAllowance:function(){return e.refreshAllowance()}},this.state);this.state.connected&&this.state.signedIn&&this.state.signedAccountId;return r.a.createElement("div",{className:"App"},r.a.createElement("a",{className:"github-fork-ribbon right-bottom fixed",href:"https://github.com/evgenykuzyakov/hexland","data-ribbon":"Fork me on GitHub",title:"Fork me on GitHub"},"Fork me on GitHub"),r.a.createElement(S,t))}}]),n}(r.a.Component);c.a.render(r.a.createElement(j,null),document.getElementById("root"))},81:function(e,t,n){},89:function(e,t,n){e.exports=n(173)},94:function(e,t,n){}},[[89,1,2]]]);
//# sourceMappingURL=main.3bc87670.chunk.js.map